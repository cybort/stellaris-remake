namespace = howitshouldbe

# on game start
event = {
	id = howitshouldbe.1
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_country = {
			howitshouldbe_tech_giveaway = yes
			set_variable = {
				which = HISBStrikeAmount
				value = 2
			}
			set_variable = {
				which = HISBStrikeCooldown
				value = 150
			}
		}
	}
}

# For any primitive civ that advances, or any other new country introduced somehow
country_event = {
	id = howitshouldbe.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		howitshouldbe_tech_giveaway = yes
		if = {
			limit = {
				has_technology = tech_spaceport_6
				has_global_flag = zhow_enable_carrier
				NOT = { has_technology = zhow_tech_carrier_1 }
			}
			give_technology = {
				tech = zhow_tech_carrier_1
				message = yes
			}
			# Immediately create carrier project
			country_event = {
				id = zhowcarrier.101
			}
		}
		# last_increased_tech can't be used in a switch statement
		# yes yes I should have used else-ifs below
		if = {
			limit = {
				last_increased_tech = {
					tech = tech_repeatable_weapon_type_strike_craft_fire_rate
					level > 0
				}
			}
			if = {
				limit = {
					check_variable = {
						which = HISBStrikeCooldown
						value > 19
					}
				}
				change_variable = {
					which = HISBStrikeCooldown
					value = -10
				}
				else = {
					country_event = { id = howitshouldbe.3 }
				}
			}
		}
		if = {
			limit = {
				last_increased_tech = {
					tech = tech_repeatable_weapon_type_strike_craft_fire_damage
					level > 0
				}
			}
			change_variable = {
				which = HISBStrikeAmount
				value = 1
			}
			country_event = { id = howitshouldbe.999 }
		}
		if = {
			limit = {
				last_increased_tech = tech_strike_craft_1
			}
			country_event = {
				id = howitshouldbe.4
			}
		}
		if = {
			limit = {
				last_increased_tech = tech_strike_craft_3
			}
			change_variable = {
				which = HISBStrikeAmount
				value = 1
			}
		}
	}
}

country_event = {
	id = howitshouldbe.999
	title = "increased"
	desc = " test test HISBStrike  Amount "
	is_triggered_only = yes
	picture = GFX_evt_fleet_good
	trigger = {
		is_country_type = default
		is_ai = no
	}
	option = { name = OK }
}

country_event = {
	id = howitshouldbe.3
	title = "Stop researching fire rate"
	desc = "howitshouldbe.explain.strike_cooldown"
	is_triggered_only = yes
	picture = GFX_evt_fleet_good
	trigger = {
		is_country_type = default
		is_ai = no
	}
	option = { name = OK }
}

country_event = {
	id = howitshouldbe.4
	title = "Strike Crafts"
	desc = "howitshouldbe.explain.strike_crafts"
	is_triggered_only = yes
	picture = GFX_evt_fleet_good
	trigger = {
		is_country_type = default
		is_ai = no
	}
	option = { name = OK }
}

ship_event = {
	id = howitshouldbe.101
	hide_window = yes
	trigger = {
		is_ship_class = shipclass_military
		exists = owner
		owner = {
			# ED, swarm, AI, Fallen etc all have techs
			has_technology = "tech_strike_craft_1"
		}
		is_in_combat = yes
		NOT = { has_ship_flag = "howitshouldbe_ignore" }
		zhow_spawner_ships = yes
	}
	immediate = {
		owner = {
			switch = {
				trigger = is_country_type
				swarm = { zhow_spawn_swarm = yes }
				extradimensional = { zhow_spawn_ed1 = yes }
				extradimensional_2 = { zhow_spawn_ed2 = yes }
				extradimensional_3 = { zhow_spawn_ed3 = yes }
				ai_empire = { zhow_spawn_ai = yes }
				guardian_hiver = { zhow_spawn_hiver = yes }
				default = {
					zhow_spawn_default = yes
				}
			}
		}
	}
}

fleet_event = {
	id = howitshouldbe.102
	hide_window = yes
	trigger = {
		is_ship_class = shipclass_military_station
		exists = owner
		owner = {
			# ED, swarm, AI, Fallen etc all have techs
			has_technology = "tech_strike_craft_1"
		}
		is_in_combat = yes
		NOT = { has_fleet_flag = "howitshouldbe_ignore" }
		zhow_spawner_stations = yes
	}
	immediate = {
		owner = {
			switch = {
				trigger = is_country_type
				swarm = { zhow_spawn_swarm_fleet = yes }
				extradimensional = { zhow_spawn_ed1_fleet = yes }
				extradimensional_2 = { zhow_spawn_ed2_fleet = yes }
				extradimensional_3 = { zhow_spawn_ed3_fleet = yes }
				ai_empire = { zhow_spawn_ai_fleet = yes }
				guardian_hiver = { zhow_spawn_hiver_fleet = yes }
			}
		}
	}
}

# on_ship_built
ship_event = {
	id = howitshouldbe.200
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			is_ship_size = strike_fighter
			is_ship_size = strike_bomber
		}
	}
	immediate = {
		set_ship_flag = zhow_timed_life
	}
}

country_event = {
	id = howitshouldbe.201
	hide_window = yes

	mean_time_to_happen = {
		days = 30
	}

	trigger = {
		any_owned_ship = {
			OR = {
				is_ship_size = strike_bomber
				is_ship_size = strike_fighter
			}
			NOT = {
				has_ship_flag = zhow_timed_life
			}
		}
	}

	immediate = {
		every_owned_ship = {
			limit = {
				OR = {
					is_ship_size = strike_bomber
					is_ship_size = strike_fighter
				}
				NOT = {
					has_ship_flag = zhow_timed_life
				}
			}
			reduce_hp_percent = 100
		}
	}
}

# console test event
fleet_event = {
	id = howitshouldbe.2000
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		while = {
			count = 10
			create_ship = {
				name = random
				random_existing_design = "strike_fighter"
				prefix = no
				effect = { set_timed_ship_flag = { flag = zhow_timed_life days = 100 } }
			}
			create_ship = {
				name = random
				random_existing_design = "strike_bomber"
				prefix = no
				effect = { set_timed_ship_flag = { flag = zhow_timed_life days = 100 } }
			}
		}
	}
}
